<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[TEST]浚渫船シミュレーター</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        header {
            background-color: #282c34;
            color: white;
            width: 100%;
            padding: 20px;
            text-align: center;
        }
        #folder-list {
            margin: 20px 0;
            display: flex;
            flex-direction: column; /* Align buttons vertically */
            gap: 15px;
            align-items: center;
        }
        .folder {
            padding: 20px 40px; /* Increase padding to make the button larger */
            font-size: 20px; /* Increase font size for bigger text */
            background-color: #61dafb;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
            width: auto;
            min-width: 200px; /* Optional: ensure buttons have a minimum width */
        }
        .folder:hover {
            background-color: #21a1f1;
        }
        iframe {
            width: 80%;
            height: 600px;
            border: none;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>ビルドセレクター</h1>
        <p>WebGLビルドをロードするバージョンを選択してください</p>
    </header>
    <div id="folder-list"></div>
    <iframe id="build-frame" src="" title="Unity WebGL Build"></iframe>

    <script>
        const basePath = './webgl-builds/';
        const folderList = document.getElementById('folder-list');
        const buildFrame = document.getElementById('build-frame');

        // Function to fetch folder list and verify they are valid Unity WebGL builds
        async function fetchFolders() {
            try {
                const response = await fetch(basePath);
                const text = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');

                // Extract folder names from <a> tags and validate they are actual directories
                const links = Array.from(doc.querySelectorAll('a'))
                    .map(link => link.getAttribute('href'))
                    .filter(name => isValidFolderName(name)); // Filter out invalid links

                const folders = [];
                for (const folderName of links) {
                    const fullPath = `${basePath}${folderName}index.html`;
                    try {
                        const buildResponse = await fetch(fullPath);
                        if (buildResponse.ok) {
                            folders.push(folderName);
                        }
                    } catch (error) {
                        console.warn(`Invalid folder: ${folderName}`);
                    }
                }

                // Sort the folders in descending order (Z-A)
                folders.sort((a, b) => b.localeCompare(a));

                displayFolders(folders);
            } catch (error) {
                console.error('Error fetching folder list:', error);
            }
        }

        // Helper function to check if a folder name is valid
        function isValidFolderName(name) {
            return (
                name &&
                !name.startsWith('?') && // Exclude query parameters like "?C=N;O=D"
                !name.startsWith('/') && // Exclude root-level paths
                name !== '../' && // Exclude parent directory
                name !== './' && // Exclude current directory
                !name.includes(';') // Exclude other invalid entries
            );
        }

        // Function to display folders as buttons
        function displayFolders(folders) {
            folderList.innerHTML = '';
            folders.forEach(folder => {
                const button = document.createElement('button');
                button.className = 'folder';
                button.textContent = `Version ${folder}`; // Add "Version " to the folder name
                button.onclick = () => openInNewTab(folder); // Open in new tab
                folderList.appendChild(button);
            });
        }

        // Function to open the selected build in a new tab
        function openInNewTab(folder) {
            const url = `${basePath}${folder}/index.html`;
            window.open(url, '_blank'); // Open in a new tab
        }

        // Initial load
        fetchFolders();
    </script>
</body>
</html>
